// Prisma Schema for Oriana Order Tracking API
// This is the single source of truth for database models

generator client {
  provider      = "prisma-client-js"
  output        = "../node_modules/.prisma/client"
  binaryTargets = ["native", "linux-arm64-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model PurchaseOrder {
  poId                  String       @id @map("po_id") @db.VarChar(20) // Format: OSG-00000001 (auto-generated)
  poReceivedDate        DateTime     @map("po_received_date") @db.Date
  clientId              Int          @map("client_id")
  client                Client       @relation(fields: [clientId], references: [clientId], onDelete: Restrict)
  osgPiNo               String       @map("osg_pi_no") @db.VarChar(50) // Alphanumeric
  osgPiDate             DateTime     @map("osg_pi_date") @db.Date
  clientPoNo            String       @map("client_po_no") @db.VarChar(50) // Alphanumeric
  clientPoDate          DateTime     @map("client_po_date") @db.Date
  poStatus              String       @map("po_status") @db.VarChar(50)
  noOfDispatch          String       @map("no_of_dispatch") @db.VarChar(20)
  assignDispatchTo      Int?         @map("assign_dispatch_to") // FK to users table (nullable)
  assignedUser          User?        @relation("AssignedUser", fields: [assignDispatchTo], references: [userId], onDelete: SetNull)
  clientAddress         String       @map("client_address")
  clientContact         String       @map("client_contact") @db.VarChar(100)
  dispatchPlanDate      DateTime     @map("dispatch_plan_date") @db.Date
  siteLocation          String       @map("site_location") @db.VarChar(255)
  oscSupport            String       @map("osc_support") @db.VarChar(20)
  confirmDateOfDispatch DateTime     @map("confirm_date_of_dispatch") @db.Date
  paymentStatus         String       @map("payment_status") @db.VarChar(50)
  remarks               String?
  createdById           Int?         @map("created_by")
  createdBy             User?        @relation("PurchaseOrderCreatedBy", fields: [createdById], references: [userId], onDelete: SetNull)
  updatedById           Int?         @map("updated_by")
  updatedBy             User?        @relation("PurchaseOrderUpdatedBy", fields: [updatedById], references: [userId], onDelete: SetNull)
  createdAt             DateTime     @default(now()) @map("created_at")
  updatedAt             DateTime     @updatedAt @map("updated_at")
  poItems               POItem[]
  fileUploads           FileUpload[] // Files uploaded for this PO
  dispatches            Dispatch[]   // Dispatches for this PO

  @@index([clientId])
  @@index([poStatus])
  @@index([createdAt])
  @@index([assignDispatchTo])
  @@map("purchase_orders")
}

model POItem {
  id            Int           @id @default(autoincrement())
  poId          String        @map("po_id")
  purchaseOrder PurchaseOrder @relation(fields: [poId], references: [poId], onDelete: Cascade)
  categoryId    Int           @map("category_id")
  category      Category      @relation(fields: [categoryId], references: [categoryId], onDelete: Restrict)
  oemId         Int           @map("oem_id")
  oem           OEM           @relation(fields: [oemId], references: [oemId], onDelete: Restrict)
  productId     Int           @map("product_id")
  product       Product       @relation(fields: [productId], references: [productId], onDelete: Restrict)
  quantity      Int
  spareQuantity Int           @default(0) @map("spare_quantity")
  totalQuantity Int           @map("total_quantity")
  pricePerUnit  Decimal       @map("price_per_unit") @db.Decimal(12, 2)
  totalPrice    Decimal       @map("total_price") @db.Decimal(14, 2)
  gstPercent    Decimal       @map("gst_percent") @db.Decimal(5, 2)
  finalPrice    Decimal       @map("final_price") @db.Decimal(14, 2)
  warranty      String        @db.VarChar(100)
  createdById   Int?          @map("created_by")
  createdBy     User?         @relation("POItemCreatedBy", fields: [createdById], references: [userId], onDelete: SetNull)
  updatedById   Int?          @map("updated_by")
  updatedBy     User?         @relation("POItemUpdatedBy", fields: [updatedById], references: [userId], onDelete: SetNull)
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")

  @@index([poId])
  @@index([categoryId])
  @@index([oemId])
  @@index([productId])
  @@map("po_items")
}

model User {
  userId                 Int              @id @default(autoincrement()) @map("user_id")
  username               String           @unique @db.VarChar(100)
  email                  String           @unique @db.VarChar(255)
  password               String           @db.VarChar(255)
  roleId                 Int?             @map("role_id") // Foreign key to roles table (1-to-1 relationship)
  role                   Role?            @relation(fields: [roleId], references: [roleId], onDelete: SetNull)
  isActive               Boolean          @default(true) @map("is_active")
  createdById            Int?             @map("created_by")
  createdBy              User?            @relation("UserCreatedBy", fields: [createdById], references: [userId], onDelete: SetNull)
  updatedById            Int?             @map("updated_by")
  updatedBy              User?            @relation("UserUpdatedBy", fields: [updatedById], references: [userId], onDelete: SetNull)
  createdAt              DateTime         @default(now()) @map("created_at")
  updatedAt              DateTime         @updatedAt @map("updated_at")
  assignedPOs            PurchaseOrder[]  @relation("AssignedUser") // POs assigned to this user for dispatch
  // Reverse relations for audit fields
  purchaseOrdersCreated  PurchaseOrder[]  @relation("PurchaseOrderCreatedBy")
  purchaseOrdersUpdated  PurchaseOrder[]  @relation("PurchaseOrderUpdatedBy")
  poItemsCreated         POItem[]         @relation("POItemCreatedBy")
  poItemsUpdated         POItem[]         @relation("POItemUpdatedBy")
  usersCreated           User[]           @relation("UserCreatedBy")
  usersUpdated           User[]           @relation("UserUpdatedBy")
  rolesCreated           Role[]           @relation("RoleCreatedBy")
  rolesUpdated           Role[]           @relation("RoleUpdatedBy")
  permissionsCreated     Permission[]     @relation("PermissionCreatedBy")
  permissionsUpdated     Permission[]     @relation("PermissionUpdatedBy")
  rolePermissionsCreated RolePermission[] @relation("RolePermissionCreatedBy")
  rolePermissionsUpdated RolePermission[] @relation("RolePermissionUpdatedBy")
  categoriesCreated      Category[]       @relation("CategoryCreatedBy")
  categoriesUpdated      Category[]       @relation("CategoryUpdatedBy")
  oemsCreated            OEM[]            @relation("OEMCreatedBy")
  oemsUpdated            OEM[]            @relation("OEMUpdatedBy")
  productsCreated        Product[]        @relation("ProductCreatedBy")
  productsUpdated        Product[]        @relation("ProductUpdatedBy")
  clientsCreated         Client[]         @relation("ClientCreatedBy")
  clientsUpdated         Client[]         @relation("ClientUpdatedBy")
  fileUploadsCreated     FileUpload[]     @relation("FileUploadCreatedBy")
  fileUploadsUpdated     FileUpload[]     @relation("FileUploadUpdatedBy")
  dispatchesCreated      Dispatch[]       @relation("DispatchCreatedBy")
  dispatchesUpdated      Dispatch[]       @relation("DispatchUpdatedBy")
  // Service Lifecycle relations
  preCommissioningsCreated    PreCommissioning[]    @relation("PreCommissioningCreatedBy")
  preCommissioningsUpdated    PreCommissioning[]    @relation("PreCommissioningUpdatedBy")
  commissioningsCreated       Commissioning[]       @relation("CommissioningCreatedBy")
  commissioningsUpdated       Commissioning[]       @relation("CommissioningUpdatedBy")
  warrantyCertificatesCreated WarrantyCertificate[] @relation("WarrantyCertificateCreatedBy")
  warrantyCertificatesUpdated WarrantyCertificate[] @relation("WarrantyCertificateUpdatedBy")

  @@index([email])
  @@index([username])
  @@index([roleId])
  @@map("users")
}

model Role {
  roleId          Int              @id @default(autoincrement()) @map("role_id")
  roleName        String           @map("role_name") @db.VarChar(100)
  description     String           @map("description") @db.VarChar(255)
  createdById     Int?             @map("created_by")
  createdBy       User?            @relation("RoleCreatedBy", fields: [createdById], references: [userId], onDelete: SetNull)
  updatedById     Int?             @map("updated_by")
  updatedBy       User?            @relation("RoleUpdatedBy", fields: [updatedById], references: [userId], onDelete: SetNull)
  isActive        Boolean          @default(true) @map("is_active")
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")
  users           User[] // Users with this role as primary role (1-to-1)
  rolePermissions RolePermission[] // A role can have multiple permissions (one-to-many)

  @@index([roleName])
  @@index([isActive])
  @@map("roles")
}

model Permission {
  permissionId    Int              @id @default(autoincrement()) @map("permission_id")
  permissionCode  String           @unique @map("permission_code") @db.VarChar(100)
  permissionName  String           @map("permission_name") @db.VarChar(100)
  description     String           @map("description") @db.VarChar(255)
  createdById     Int?             @map("created_by")
  createdBy       User?            @relation("PermissionCreatedBy", fields: [createdById], references: [userId], onDelete: SetNull)
  updatedById     Int?             @map("updated_by")
  updatedBy       User?            @relation("PermissionUpdatedBy", fields: [updatedById], references: [userId], onDelete: SetNull)
  isActive        Boolean          @default(true) @map("is_active")
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")
  rolePermissions RolePermission[] // A permission can belong to multiple roles (many-to-many)

  @@index([permissionName])
  @@index([permissionCode])
  @@index([isActive])
  @@map("permissions")
}

model RolePermission {
  rolePermissionId Int        @id @default(autoincrement()) @map("role_permission_id")
  roleId           Int        @map("role_id")
  permissionId     Int        @map("permission_id")
  role             Role       @relation(fields: [roleId], references: [roleId], onDelete: Cascade)
  permission       Permission @relation(fields: [permissionId], references: [permissionId], onDelete: Cascade)
  createdById      Int?       @map("created_by")
  createdBy        User?      @relation("RolePermissionCreatedBy", fields: [createdById], references: [userId], onDelete: SetNull)
  updatedById      Int?       @map("updated_by")
  updatedBy        User?      @relation("RolePermissionUpdatedBy", fields: [updatedById], references: [userId], onDelete: SetNull)
  isActive         Boolean    @default(true) @map("is_active")
  createdAt        DateTime   @default(now()) @map("created_at")
  updatedAt        DateTime   @updatedAt @map("updated_at")

  @@unique([roleId, permissionId])
  @@index([roleId])
  @@index([permissionId])
  @@index([isActive])
  @@map("role_permissions")
}

model Category {
  categoryId   Int       @id @default(autoincrement()) @map("category_id")
  categoryName String    @map("category_name") @db.VarChar(100)
  isActive     Boolean   @default(true) @map("is_active")
  createdById  Int?      @map("created_by")
  createdBy    User?     @relation("CategoryCreatedBy", fields: [createdById], references: [userId], onDelete: SetNull)
  updatedById  Int?      @map("updated_by")
  updatedBy    User?     @relation("CategoryUpdatedBy", fields: [updatedById], references: [userId], onDelete: SetNull)
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")
  products     Product[]
  poItems      POItem[] // PO items using this category

  @@index([categoryName])
  @@index([isActive])
  @@map("categories")
}

model OEM {
  oemId       Int       @id @default(autoincrement()) @map("oem_id")
  oemName     String    @map("oem_name") @db.VarChar(100)
  isActive    Boolean   @default(true) @map("is_active")
  createdById Int?      @map("created_by")
  createdBy   User?     @relation("OEMCreatedBy", fields: [createdById], references: [userId], onDelete: SetNull)
  updatedById Int?      @map("updated_by")
  updatedBy   User?     @relation("OEMUpdatedBy", fields: [updatedById], references: [userId], onDelete: SetNull)
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  products    Product[]
  poItems     POItem[] // PO items using this OEM

  @@index([oemName])
  @@index([isActive])
  @@map("oems")
}

model Product {
  productId       Int              @id @default(autoincrement()) @map("product_id")
  productName     String           @map("product_name") @db.VarChar(100)
  isActive        Boolean          @default(true) @map("is_active")
  categoryId      Int              @map("category_id")
  category        Category         @relation(fields: [categoryId], references: [categoryId])
  oemId           Int              @map("oem_id")
  oem             OEM              @relation(fields: [oemId], references: [oemId])
  createdById     Int?             @map("created_by")
  createdBy       User?            @relation("ProductCreatedBy", fields: [createdById], references: [userId], onDelete: SetNull)
  updatedById     Int?             @map("updated_by")
  updatedBy       User?            @relation("ProductUpdatedBy", fields: [updatedById], references: [userId], onDelete: SetNull)
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")
  poItems         POItem[]         // PO items using this product
  dispatchedItems DispatchedItem[] // Dispatched items using this product

  @@index([productName])
  @@index([isActive])
  @@index([categoryId])
  @@index([oemId])
  @@map("products")
}

model Client {
  clientId       Int             @id @default(autoincrement()) @map("client_id")
  clientName     String          @map("client_name") @db.VarChar(255)
  clientAddress  String?         @map("client_address")
  clientContact  String?         @map("client_contact") @db.VarChar(100)
  clientGST      String?         @map("client_gst") @db.VarChar(50)
  isActive       Boolean         @default(true) @map("is_active")
  createdById    Int?            @map("created_by")
  createdBy      User?           @relation("ClientCreatedBy", fields: [createdById], references: [userId], onDelete: SetNull)
  updatedById    Int?            @map("updated_by")
  updatedBy      User?           @relation("ClientUpdatedBy", fields: [updatedById], references: [userId], onDelete: SetNull)
  createdAt      DateTime        @default(now()) @map("created_at")
  updatedAt      DateTime        @updatedAt @map("updated_at")
  purchaseOrders PurchaseOrder[] // POs for this client

  @@index([clientName])
  @@index([isActive])
  @@map("clients")
}

// File Upload model for S3 file management
// Supports staged upload workflow: pending -> confirmed -> deleted
model FileUpload {
  fileId           Int            @id @default(autoincrement()) @map("file_id")
  originalFileName String         @map("original_file_name") @db.VarChar(255)
  storedFileName   String         @map("stored_file_name") @db.VarChar(255)
  mimeType         String         @map("mime_type") @db.VarChar(100)
  fileSize         Int            @map("file_size") // Size in bytes
  s3Key            String         @map("s3_key") @db.VarChar(500)
  s3Bucket         String         @map("s3_bucket") @db.VarChar(100)
  status           String         @default("pending") @map("status") @db.VarChar(20) // pending, confirmed, deleted
  entityType       String?        @map("entity_type") @db.VarChar(50) // dispatch, delivery, ppm, commissioning, warranty
  entityId         String?        @map("entity_id") @db.VarChar(50)
  poId             String?        @map("po_id") @db.VarChar(20)
  purchaseOrder    PurchaseOrder? @relation(fields: [poId], references: [poId], onDelete: SetNull)
  createdById      Int?           @map("created_by")
  createdBy        User?          @relation("FileUploadCreatedBy", fields: [createdById], references: [userId], onDelete: SetNull)
  updatedById      Int?           @map("updated_by")
  updatedBy        User?          @relation("FileUploadUpdatedBy", fields: [updatedById], references: [userId], onDelete: SetNull)
  confirmedAt      DateTime?      @map("confirmed_at")
  createdAt        DateTime       @default(now()) @map("created_at")
  updatedAt        DateTime       @updatedAt @map("updated_at") // Auto-updated on every modification

  @@index([status])
  @@index([entityType, entityId])
  @@index([poId])
  @@index([createdAt])
  @@map("file_uploads")
}

// Dispatch model for tracking product dispatches
model Dispatch {
  dispatchId          Int              @id @default(autoincrement()) @map("dispatch_id")
  poId                String           @map("po_id") @db.VarChar(20)
  purchaseOrder       PurchaseOrder    @relation(fields: [poId], references: [poId], onDelete: Cascade)

  // Dispatch Details Fields (Section 1)
  projectName         String           @map("project_name") @db.VarChar(255)
  projectLocation     String           @map("project_location") @db.VarChar(255)
  deliveryLocation    String           @map("delivery_location") @db.VarChar(255)
  deliveryAddress     String           @map("delivery_address") @db.Text
  googleMapLink       String?          @map("google_map_link") @db.VarChar(500)
  confirmDispatchDate DateTime         @map("confirm_dispatch_date") @db.Date
  deliveryContact     String           @map("delivery_contact") @db.VarChar(100)
  remarks             String?          @db.Text

  // Document Fields (Section 2 - Optional)
  noDuesClearance     String?          @map("no_dues_clearance") @db.VarChar(50)
  docOsgPiNo          String?          @map("doc_osg_pi_no") @db.VarChar(50)
  docOsgPiDate        DateTime?        @map("doc_osg_pi_date") @db.Date
  taxInvoiceNumber    String?          @map("tax_invoice_number") @db.VarChar(100)
  invoiceDate         DateTime?        @map("invoice_date") @db.Date
  ewayBill            String?          @map("eway_bill") @db.VarChar(100)
  deliveryChallan     String?          @map("delivery_challan") @db.VarChar(100)
  dispatchDate        DateTime?        @map("dispatch_date") @db.Date
  packagingList       String?          @map("packaging_list") @db.Text
  dispatchFromLocation String?         @map("dispatch_from_location") @db.VarChar(255)
  dispatchStatus      String?          @map("dispatch_status") @db.VarChar(50)
  dispatchLrNo        String?          @map("dispatch_lr_no") @db.VarChar(100)
  dispatchRemarks     String?          @map("dispatch_remarks") @db.Text
  documentUpdatedAt   DateTime?        @map("document_updated_at")

  // Delivery Confirmation Fields (Section 3 - Optional)
  dateOfDelivery      DateTime?        @map("date_of_delivery") @db.Date
  deliveryStatus      String?          @map("delivery_status") @db.VarChar(50)
  proofOfDelivery     String?          @map("proof_of_delivery") @db.Text
  deliveryUpdatedAt   DateTime?        @map("delivery_updated_at")

  // Audit Fields
  createdById         Int?             @map("created_by")
  createdBy           User?            @relation("DispatchCreatedBy", fields: [createdById], references: [userId], onDelete: SetNull)
  updatedById         Int?             @map("updated_by")
  updatedBy           User?            @relation("DispatchUpdatedBy", fields: [updatedById], references: [userId], onDelete: SetNull)
  createdAt           DateTime         @default(now()) @map("created_at")
  updatedAt           DateTime         @updatedAt @map("updated_at")

  // Relations
  dispatchedItems     DispatchedItem[]
  preCommissionings   PreCommissioning[]

  @@index([poId])
  @@index([dispatchStatus])
  @@index([deliveryStatus])
  @@index([createdAt])
  @@map("dispatches")
}

// DispatchedItem model for tracking items in each dispatch
model DispatchedItem {
  id            Int      @id @default(autoincrement())
  dispatchId    Int      @map("dispatch_id")
  dispatch      Dispatch @relation(fields: [dispatchId], references: [dispatchId], onDelete: Cascade)
  productId     Int      @map("product_id")
  product       Product  @relation(fields: [productId], references: [productId], onDelete: Restrict)
  quantity      Int
  serialNumbers String?  @map("serial_numbers") @db.Text // Comma-separated serial numbers

  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  @@index([dispatchId])
  @@index([productId])
  @@map("dispatched_items")
}

// ============================================================================
// SERVICE LIFECYCLE MODELS
// Pre-Commissioning -> Commissioning -> Warranty Certificate
// ============================================================================

// Pre-Commissioning model for tracking pre-commissioning activities
// Created after delivery is confirmed (deliveryStatus = "done")
model PreCommissioning {
  preCommissioningId        Int               @id @default(autoincrement()) @map("pre_commissioning_id")
  dispatchId                Int               @map("dispatch_id")
  dispatch                  Dispatch          @relation(fields: [dispatchId], references: [dispatchId], onDelete: Cascade)
  serialNumber              String            @map("serial_number") @db.VarChar(100)
  productName               String            @map("product_name") @db.VarChar(255)

  // Pre-Commissioning Details
  pcContact                 String            @map("pc_contact") @db.VarChar(255) // Client side coordinator
  serviceEngineerAssigned   String            @map("service_engineer_assigned") @db.VarChar(255)
  ppmChecklist              String            @map("ppm_checklist") @db.VarChar(255)
  ppmSheetReceivedFromClient String           @map("ppm_sheet_received_from_client") @db.VarChar(255)
  ppmChecklistSharedWithOem String            @map("ppm_checklist_shared_with_oem") @db.VarChar(255)
  ppmTickedNoFromOem        String            @map("ppm_ticked_no_from_oem") @db.VarChar(255)
  ppmConfirmationStatus     String            @map("ppm_confirmation_status") @db.VarChar(50) // Done, Pending, Hold, Cancelled
  oemComments               String?           @map("oem_comments") @db.Text
  preCommissioningStatus    String            @map("pre_commissioning_status") @db.VarChar(50) // Done, Pending, Hold, Cancelled
  remarks                   String?           @db.Text

  // Audit Fields
  createdById               Int?              @map("created_by")
  createdBy                 User?             @relation("PreCommissioningCreatedBy", fields: [createdById], references: [userId], onDelete: SetNull)
  updatedById               Int?              @map("updated_by")
  updatedBy                 User?             @relation("PreCommissioningUpdatedBy", fields: [updatedById], references: [userId], onDelete: SetNull)
  createdAt                 DateTime          @default(now()) @map("created_at")
  updatedAt                 DateTime          @updatedAt @map("updated_at")

  // Relations
  commissioning             Commissioning?

  @@unique([dispatchId, serialNumber]) // Each serial number can only have one pre-commissioning per dispatch
  @@index([dispatchId])
  @@index([preCommissioningStatus])
  @@index([createdAt])
  @@map("pre_commissionings")
}

// Commissioning model for tracking commissioning activities
// Created after pre-commissioning is done (preCommissioningStatus = "Done")
model Commissioning {
  commissioningId           Int               @id @default(autoincrement()) @map("commissioning_id")
  preCommissioningId        Int               @unique @map("pre_commissioning_id")
  preCommissioning          PreCommissioning  @relation(fields: [preCommissioningId], references: [preCommissioningId], onDelete: Cascade)

  // Commissioning Details
  ecdFromClient             String?           @map("ecd_from_client") @db.VarChar(255) // Expected Commissioning Date from client
  serviceTicketNo           String?           @map("service_ticket_no") @db.VarChar(100) // Service Ticket No from OEM
  ccdFromClient             String?           @map("ccd_from_client") @db.VarChar(255) // Confirm Commissioning Date from client
  issues                    String?           @db.Text // Issues in commissioning
  solution                  String?           @db.Text // Solution on issues
  infoGenerated             String?           @map("info_generated") @db.VarChar(255) // Information generated
  commissioningDate         DateTime?         @map("commissioning_date") @db.Date
  commissioningStatus       String            @map("commissioning_status") @db.VarChar(50) // Done, Pending, Hold, Cancelled
  remarks                   String?           @db.Text

  // Audit Fields
  createdById               Int?              @map("created_by")
  createdBy                 User?             @relation("CommissioningCreatedBy", fields: [createdById], references: [userId], onDelete: SetNull)
  updatedById               Int?              @map("updated_by")
  updatedBy                 User?             @relation("CommissioningUpdatedBy", fields: [updatedById], references: [userId], onDelete: SetNull)
  createdAt                 DateTime          @default(now()) @map("created_at")
  updatedAt                 DateTime          @updatedAt @map("updated_at")

  // Relations
  warrantyCertificate       WarrantyCertificate?

  @@index([preCommissioningId])
  @@index([commissioningStatus])
  @@index([createdAt])
  @@map("commissionings")
}

// Warranty Certificate model for tracking warranty certificates
// Created after commissioning is done (commissioningStatus = "Done")
model WarrantyCertificate {
  warrantyCertificateId     Int               @id @default(autoincrement()) @map("warranty_certificate_id")
  commissioningId           Int               @unique @map("commissioning_id")
  commissioning             Commissioning     @relation(fields: [commissioningId], references: [commissioningId], onDelete: Cascade)

  // Warranty Certificate Details
  certificateNo             String            @map("certificate_no") @db.VarChar(100)
  issueDate                 DateTime          @map("issue_date") @db.Date
  warrantyStartDate         DateTime          @map("warranty_start_date") @db.Date
  warrantyEndDate           DateTime          @map("warranty_end_date") @db.Date
  warrantyStatus            String            @map("warranty_status") @db.VarChar(50) // Done, Pending, Hold, Cancelled

  // Audit Fields
  createdById               Int?              @map("created_by")
  createdBy                 User?             @relation("WarrantyCertificateCreatedBy", fields: [createdById], references: [userId], onDelete: SetNull)
  updatedById               Int?              @map("updated_by")
  updatedBy                 User?             @relation("WarrantyCertificateUpdatedBy", fields: [updatedById], references: [userId], onDelete: SetNull)
  createdAt                 DateTime          @default(now()) @map("created_at")
  updatedAt                 DateTime          @updatedAt @map("updated_at")

  @@index([commissioningId])
  @@index([warrantyStatus])
  @@index([createdAt])
  @@map("warranty_certificates")
}
